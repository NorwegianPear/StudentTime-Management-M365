<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 700" width="1200" height="700">
  <defs>
    <!-- Gradients -->
    <linearGradient id="azureBlue" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0078D4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#005A9E;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#107C10;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0B5C0B;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#D13438;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#A4262C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8764B8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5C2D91;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="entraBlue" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00BCF2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0078D4;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FF8C00;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D86E00;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="4" flood-opacity="0.15"/>
    </filter>
    <!-- Arrow markers -->
    <marker id="arrowBlue" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L4,6 Z" fill="#0078D4"/>
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L4,6 Z" fill="#107C10"/>
    </marker>
    <marker id="arrowRed" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L4,6 Z" fill="#D13438"/>
    </marker>
    <marker id="arrowPurple" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L4,6 Z" fill="#5C2D91"/>
    </marker>
    <marker id="arrowOrange" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M2,2 L10,6 L2,10 L4,6 Z" fill="#FF8C00"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="700" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Segoe UI, Arial" font-size="24" font-weight="600" fill="#323130">
    Student Access Control - Data Flow Diagram
  </text>
  <text x="600" y="65" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" fill="#605E5C">
    Morning Enable &amp; Afternoon Disable Process Flow
  </text>

  <!-- Step 1: Schedule Trigger -->
  <g transform="translate(50, 120)">
    <rect x="0" y="0" width="160" height="100" rx="50" fill="url(#azureBlue)" filter="url(#shadow)"/>
    <text x="80" y="40" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" font-weight="600" fill="white">‚è∞ Azure Scheduler</text>
    <text x="80" y="60" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="white" opacity="0.9">Triggers at</text>
    <text x="80" y="78" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#FFB900" font-weight="bold">07:55 / 16:05</text>
    <circle cx="80" cy="0" r="18" fill="#FFB900"/>
    <text x="80" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">1</text>
  </g>

  <!-- Step 2: Runbook Execution -->
  <g transform="translate(280, 120)">
    <rect x="0" y="0" width="180" height="100" rx="8" fill="white" stroke="#0078D4" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="30" rx="8" fill="url(#azureBlue)"/>
    <rect x="0" y="24" width="180" height="6" fill="url(#azureBlue)"/>
    <text x="90" y="20" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="white">üìú Runbook Starts</text>
    <text x="90" y="52" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Load encrypted</text>
    <text x="90" y="68" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">credentials from</text>
    <text x="90" y="84" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#FFB900" font-weight="600">Azure Variables</text>
    <circle cx="90" cy="0" r="18" fill="#FFB900"/>
    <text x="90" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">2</text>
  </g>

  <!-- Step 3: Connect to Graph -->
  <g transform="translate(530, 120)">
    <rect x="0" y="0" width="180" height="100" rx="8" fill="white" stroke="#5C2D91" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="30" rx="8" fill="url(#purpleGrad)"/>
    <rect x="0" y="24" width="180" height="6" fill="url(#purpleGrad)"/>
    <text x="90" y="20" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="white">üîó Connect-MgGraph</text>
    <text x="90" y="52" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Authenticate using</text>
    <text x="90" y="68" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Client Credentials</text>
    <text x="90" y="84" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#5C2D91" font-weight="600">OAuth 2.0 Flow</text>
    <circle cx="90" cy="0" r="18" fill="#FFB900"/>
    <text x="90" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">3</text>
  </g>

  <!-- Step 4: Get Group Members -->
  <g transform="translate(780, 120)">
    <rect x="0" y="0" width="180" height="100" rx="8" fill="white" stroke="#00BCF2" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="30" rx="8" fill="url(#entraBlue)"/>
    <rect x="0" y="24" width="180" height="6" fill="url(#entraBlue)"/>
    <text x="90" y="20" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="white">üë• Get-MgGroupMember</text>
    <text x="90" y="52" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Query student</text>
    <text x="90" y="68" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">security group</text>
    <text x="90" y="84" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#00BCF2" font-weight="600">Returns: User IDs</text>
    <circle cx="90" cy="0" r="18" fill="#FFB900"/>
    <text x="90" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">4</text>
  </g>

  <!-- Step 5: Loop Box -->
  <g transform="translate(1010, 100)">
    <rect x="0" y="0" width="150" height="140" rx="8" fill="#FFF4CE" stroke="#FF8C00" stroke-width="2" stroke-dasharray="5,3" filter="url(#shadow)"/>
    <text x="75" y="25" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="#FF8C00">üîÑ ForEach Student</text>
    <text x="75" y="50" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Process each</text>
    <text x="75" y="68" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">user account</text>
    <text x="75" y="90" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">500 - 5,000</text>
    <text x="75" y="105" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">iterations</text>
    <path d="M75 115 C75 125, 135 125, 135 115" stroke="#FF8C00" stroke-width="2" fill="none" marker-end="url(#arrowOrange)"/>
    <circle cx="75" cy="0" r="18" fill="#FFB900"/>
    <text x="75" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">5</text>
  </g>

  <!-- Arrows Row 1 -->
  <path d="M210 170 L280 170" stroke="#0078D4" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>
  <path d="M460 170 L530 170" stroke="#0078D4" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>
  <path d="M710 170 L780 170" stroke="#5C2D91" stroke-width="3" fill="none" marker-end="url(#arrowPurple)"/>
  <path d="M960 170 L1010 170" stroke="#00BCF2" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>

  <!-- Enable/Disable Split Section -->
  <text x="600" y="280" text-anchor="middle" font-family="Segoe UI, Arial" font-size="16" font-weight="600" fill="#323130">
    Decision: Morning or Afternoon?
  </text>

  <!-- Diamond decision -->
  <g transform="translate(520, 300)">
    <polygon points="80,0 160,50 80,100 0,50" fill="white" stroke="#FF8C00" stroke-width="2" filter="url(#shadow)"/>
    <text x="80" y="45" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="#323130">07:55</text>
    <text x="80" y="60" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="#323130">or 16:05?</text>
  </g>

  <!-- Enable Path (Left - Green) -->
  <g transform="translate(150, 320)">
    <rect x="0" y="0" width="200" height="120" rx="8" fill="white" stroke="#107C10" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="35" rx="8" fill="url(#greenGrad)"/>
    <rect x="0" y="28" width="200" height="7" fill="url(#greenGrad)"/>
    <text x="100" y="24" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" font-weight="600" fill="white">üü¢ ENABLE (07:55)</text>
    <text x="100" y="60" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" fill="#323130">Update-MgUser</text>
    <text x="100" y="80" text-anchor="middle" font-family="Consolas" font-size="10" fill="#107C10">accountEnabled = $true</text>
    <text x="100" y="105" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">Students can sign in</text>
    <circle cx="100" cy="0" r="18" fill="#107C10"/>
    <text x="100" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">6a</text>
  </g>

  <!-- Disable Path (Right - Red) -->
  <g transform="translate(850, 320)">
    <rect x="0" y="0" width="220" height="180" rx="8" fill="white" stroke="#D13438" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="220" height="35" rx="8" fill="url(#redGrad)"/>
    <rect x="0" y="28" width="220" height="7" fill="url(#redGrad)"/>
    <text x="110" y="24" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" font-weight="600" fill="white">üî¥ DISABLE (16:05)</text>
    
    <text x="110" y="55" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" font-weight="600" fill="#323130">Step 1: Disable Account</text>
    <text x="110" y="72" text-anchor="middle" font-family="Consolas" font-size="9" fill="#D13438">accountEnabled = $false</text>
    
    <line x1="20" y1="85" x2="200" y2="85" stroke="#E6E6E6" stroke-width="1"/>
    
    <text x="110" y="105" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" font-weight="600" fill="#323130">Step 2: Revoke Sessions</text>
    <text x="110" y="122" text-anchor="middle" font-family="Consolas" font-size="9" fill="#D13438">Invoke-MgInvalidate</text>
    <text x="110" y="138" text-anchor="middle" font-family="Consolas" font-size="9" fill="#D13438">UserRefreshToken</text>
    
    <rect x="30" y="150" width="160" height="22" rx="4" fill="#FFCDD2"/>
    <text x="110" y="165" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#A4262C">‚ö†Ô∏è Active sessions terminated</text>
    
    <circle cx="110" cy="0" r="18" fill="#D13438"/>
    <text x="110" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">6b</text>
  </g>

  <!-- Arrows to decision -->
  <path d="M520 350 L350 380" stroke="#107C10" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="420" y="355" font-family="Segoe UI, Arial" font-size="10" fill="#107C10" font-weight="600">Morning</text>
  
  <path d="M680 350 L850 380" stroke="#D13438" stroke-width="3" fill="none" marker-end="url(#arrowRed)"/>
  <text x="750" y="355" font-family="Segoe UI, Arial" font-size="10" fill="#D13438" font-weight="600">Afternoon</text>

  <!-- Step 7: Complete -->
  <g transform="translate(470, 550)">
    <rect x="0" y="0" width="260" height="80" rx="8" fill="url(#azureBlue)" filter="url(#shadow)"/>
    <text x="130" y="30" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="600" fill="white">‚úÖ Job Complete</text>
    <text x="130" y="52" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="white" opacity="0.9">Disconnect-MgGraph</text>
    <text x="130" y="68" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="white" opacity="0.9">Log results to Azure Monitor</text>
    <circle cx="130" cy="0" r="18" fill="#FFB900"/>
    <text x="130" y="5" text-anchor="middle" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white">7</text>
  </g>

  <!-- Arrows to complete -->
  <path d="M250 440 L250 530 L470 590" stroke="#107C10" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
  <path d="M960 500 L960 530 L730 590" stroke="#D13438" stroke-width="3" fill="none" marker-end="url(#arrowRed)"/>

  <!-- Legend -->
  <g transform="translate(50, 620)">
    <rect x="0" y="0" width="400" height="60" rx="6" fill="white" stroke="#BEBBB8" filter="url(#shadow)"/>
    <text x="200" y="18" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="#323130">Legend</text>
    
    <line x1="20" y1="38" x2="50" y2="38" stroke="#107C10" stroke-width="3"/>
    <text x="60" y="42" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">Enable Flow</text>
    
    <line x1="140" y1="38" x2="170" y2="38" stroke="#D13438" stroke-width="3"/>
    <text x="180" y="42" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">Disable Flow</text>
    
    <line x1="260" y1="38" x2="290" y2="38" stroke="#5C2D91" stroke-width="3"/>
    <text x="300" y="42" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">API Call</text>
  </g>

  <!-- Timing info -->
  <g transform="translate(750, 620)">
    <rect x="0" y="0" width="400" height="60" rx="6" fill="#E6F7FF" stroke="#0078D4" filter="url(#shadow)"/>
    <text x="200" y="18" text-anchor="middle" font-family="Segoe UI, Arial" font-size="11" font-weight="600" fill="#0078D4">‚è±Ô∏è Execution Time</text>
    <text x="200" y="38" text-anchor="middle" font-family="Segoe UI, Arial" font-size="10" fill="#323130">Typical: 2-5 minutes for 1,000 users</text>
    <text x="200" y="52" text-anchor="middle" font-family="Segoe UI, Arial" font-size="9" fill="#605E5C">Uses batch processing for efficiency</text>
  </g>
</svg>
